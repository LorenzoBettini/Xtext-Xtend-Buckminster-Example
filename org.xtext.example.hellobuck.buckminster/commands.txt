setpref targetPlatformPath="${target.platform}"

resolve "${projects.location}/org.xtext.example.hellobuck.buckminster/projects-platform.cquery"
resolve "${projects.location}/org.xtext.example.hellobuck.buckminster/project.cquery"

clean

# this first Java build will fail with compilation errors, since Xtend
# classes have not been compiled yet.  However, it will compile some
# Java classes so that we will be able to compile Xtend classes
build --continueonerror

launch --stderr --stdout -l "org.xtext.example.hellobuck/XtendCompiler.launch"
build --continueonerror
# you need to run a Java build to compile the Java files generated by
# the Xtend compiler.  They will be needed for compiling Xtend classes
# in the UI plugin.

launch --stderr --stdout -l "org.xtext.example.hellobuck.ui/XtendCompiler.launch"
build --continueonerror
# you need to run a Java build to compile the Java files generated by
# the Xtend compiler.  They will be needed for compiling Xtend classes
# in the TESTS plugin.

launch --stderr --stdout -l "org.xtext.example.hellobuck.tests/XtendCompiler.launch"

build --clean

junit -l "org.xtext.example.hellobuck.tests/org.xtext.example.hellobuck.tests.launch"  --flatXML --output "${buckminster.output.root}/test.results/org.xtext.example.hellobuck.tests.launch.xml"
junit -l "org.xtext.example.hellobuck.tests/org.xtext.example.hellobuck.ui.tests.launch"  --flatXML --output "${buckminster.output.root}/test.results/org.xtext.example.hellobuck.ui.tests.launch.xml"

perform "org.xtext.example.hellobuck.site#site.p2"
